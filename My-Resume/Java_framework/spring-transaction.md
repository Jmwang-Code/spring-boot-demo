# Spring的事务是如何回滚的？

Spring的事务回滚是通过AOP实现的，其大致流程如下：

1. 通过AOP为@Transactional注解的方法生成代理对象；
   2. 代理对象在执行目标方法之前，会先执行TransactionInterceptor的invoke方法；
3. TransactionInterceptor的invoke方法中，会先执行事务的开启，然后执行目标方法，最后执行事务的提交或回滚。

# Spring事务失效的原因有哪些？
1. 事务传播属性设置不当，使用其他传播属性
2. 异常处理不当，事务方法中出现try-catch代码块
3. 数据库引擎不支持事务，如MyISAM
4. 在父函数设置了@Transactional，子函数没有设置@Transactional

# 两个事务主要解决的三种模式
现在存在父类A事务，子类B事务。
1. 融入，B事务融入A事务。干掉B的事务。
2. 挂起，A事务挂起，B事务执行完毕后，A事务继续执行。
3. 嵌套，B事务嵌套在A事务中，B事务执行完毕后，A事务继续执行。（这种不支持，但是可以通过保存点模拟）

# Spring常用的事务传播行为有哪些？

Required（需要事务，修改性的操作）：如果当前存在事务，则加入该事务；如果当前没有事务，则创建一个新的事务。

Supports（支持事务，查询性的操作）：如果当前存在事务，则加入该事务；如果当前没有事务，则以非事务的方式继续运行。

Requireds_new（需要新的事务，修改性的操作）：创建一个新的事务，如果当前存在事务，则把当前事务挂起。

Not_supported（不支持事务，查询性的操作）：以非事务方式运行，如果当前存在事务，则把当前事务挂起。