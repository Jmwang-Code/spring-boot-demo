<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/processdef">
  <process id="LeaveApplicationProcess" name="LeaveApplicationProcess" isExecutable="true">
    <documentation>休假申请流程</documentation>
    <startEvent id="T1_LeaveStart" name="LeaveStart">
      <documentation>请假开始</documentation>
    </startEvent>
    <!-- activiti:assignee 分配到任务的人 -->
    <userTask id="T2_LeaveApplication" name="LeaveApplication">
      <documentation>任务申请</documentation>
      <!-- <activiti:taskListener>：在 userTask 节点上使用 taskListener 元素，可以在任务创建和完成时触发自定义逻辑。
      在这里，我们使用 event="create" 来在任务创建时触发逻辑，使用 event="complete" 来在任务完成时触发逻辑。 -->
      <extensionElements>
        <activiti:taskListener event="create" class="org.activiti.engine.delegate.TaskListener">
          <!-- <activiti:field>：在 taskListener 中使用 field 元素，可以设置任务的属性。
          在这里，我们使用 name="assignment" 来设置任务的分配人，name="approvalDecision" 来设置任务的审批决策。 -->
          <activiti:field name="assignment" stringValue="${applicant}"/>
        </activiti:taskListener>
      </extensionElements>
      <!-- <multiInstanceLoopCharacteristics>：使用 multiInstanceLoopCharacteristics 元素可以实现多实例任务，即多个审批人依次处理任务。
      在这里，我们使用 isSequential="false" 来指定并行处理，loopCardinality 来指定审批人数量，completionCondition 来指定完成条件。 -->
      <multiInstanceLoopCharacteristics isSequential="false">
        <loopCardinality>${numberOfApprovers}</loopCardinality>
        <completionCondition>${approvedCount &gt;= numberOfApprovers or rejectedCount &gt; 0}</completionCondition>
      </multiInstanceLoopCharacteristics>
      <extensionElements>
        <activiti:taskListener event="complete" class="org.activiti.engine.delegate.TaskListener">
          <activiti:field name="approvalDecision" expression="${approved ? 'approve' : 'reject'}"/>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="Path1" sourceRef="T2_LeaveApplication" targetRef="T3_1NodeSwitching"/>
    <userTask id="T4_FirstLevelApproval" name="FirstLevelApproval">
      <documentation>一级审批</documentation>
    </userTask>
    <sequenceFlow id="Path2" sourceRef="T1_LeaveStart" targetRef="T2_LeaveApplication"/>
    <endEvent id="T_End" name="LeaveEnded">
      <documentation>请假任务结束</documentation>
    </endEvent>
    <sequenceFlow id="Path3" sourceRef="T4_FirstLevelApproval" targetRef="T_End"/>
    <exclusiveGateway id="T3_1NodeSwitching" name="1NodeSwitching" default="Path4">
      <documentation>第一个切换节点</documentation>
    </exclusiveGateway>
    <sequenceFlow id="Path4" sourceRef="T3_1NodeSwitching" targetRef="T4_FirstLevelApproval">
      <conditionExpression xsi:type="tFormalExpression"/>
    </sequenceFlow>
    <sequenceFlow id="Path5" sourceRef="T3_1NodeSwitching" targetRef="T_End">
      <conditionExpression xsi:type="tFormalExpression"/>
    </sequenceFlow>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_LeaveApplicationProcess">
    <bpmndi:BPMNPlane bpmnElement="LeaveApplicationProcess" id="BPMNPlane_LeaveApplicationProcess">
      <bpmndi:BPMNShape id="shape-1b4d66d6-e27f-4b13-833e-c9520b1dd2f0" bpmnElement="T1_LeaveStart">
        <omgdc:Bounds x="-480.74997" y="-538.0" width="30.0" height="30.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="shape-eb63713e-972b-4a50-8c35-a5d28d4e8173" bpmnElement="T2_LeaveApplication">
        <omgdc:Bounds x="-515.75" y="-474.3082" width="100.0" height="80.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="edge-9f2f9389-4c12-4b40-9acd-113bf8b642a4" bpmnElement="Path2">
        <omgdi:waypoint x="-465.74994" y="-508.0"/>
        <omgdi:waypoint x="-465.75" y="-483.32706"/>
        <omgdi:waypoint x="-465.75" y="-468.6541"/>
        <omgdi:waypoint x="-465.75" y="-474.3082"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="shape-7c0631d0-aca3-4c32-92a2-45e9cf66a8c9" bpmnElement="T_End">
        <omgdc:Bounds x="-480.75" y="-186.0" width="30.0" height="30.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="edge-4b2b2afd-4780-4007-a9de-aac59cc860e1" bpmnElement="Path1">
        <omgdi:waypoint x="-465.75" y="-394.3082"/>
        <omgdi:waypoint x="-465.75" y="-365.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="sid-f739bed6-a3f1-470d-9d04-3ce2737c2e62" bpmnElement="T4_FirstLevelApproval">
        <omgdc:Bounds x="-370.75" y="-302.2422" width="100.0" height="80.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="edge-a15fced2-3c65-4c39-9739-acf8a7a1dcad" bpmnElement="Path3">
        <omgdi:waypoint x="-320.75" y="-222.24219"/>
        <omgdi:waypoint x="-450.75" y="-171.0"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="shape-b8adb32e-fe8e-49cf-99d5-957b27b607da" bpmnElement="T3_1NodeSwitching">
        <omgdc:Bounds x="-485.75" y="-365.0" width="40.0" height="40.0"/>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="edge-6279c23a-61b0-4e33-886a-99a4fd3d3dc9" bpmnElement="Path4">
        <omgdi:waypoint x="-445.75" y="-345.0"/>
        <omgdi:waypoint x="-320.75" y="-302.2422"/>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge-43a9676f-5d99-4ac1-8d83-d4895fe026cd" bpmnElement="Path5">
        <omgdi:waypoint x="-465.75" y="-330.0"/>
        <omgdi:waypoint x="-465.75" y="-186.0"/>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
